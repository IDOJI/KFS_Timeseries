# ğŸŸ¥ ë°ì´í„°ë¡œë“œ ===================================================================================================
path_data = "/Users/Ido/Documents/GitHub/KFS_Timeseries_Data/4.Exported Data_by ID/@_á„Œá…©á„…á…µá†·/(@á„‹á…ªá†«á„…á…­)á„‰á…®á„Œá…©á†¼á„‡á…§á†¯ á„Œá…©á„…á…µá†·á„‰á…µá†¯á„Œá…¥á†¨Plantation forest by tree species/@á„‹á…ªá†«á„…á…­/5.2023á„‚á…§á†«á„ƒá…©_á„‡á…©á†¨á„‡á…®á‡€/2023_YRBK_00530405.xlsx"
data = read.xlsx(path_data)

View(data)


# ğŸŸ¥ "ê·¸ë£¨ìˆ˜"ì—´ ì œì™¸ ===================================================================================================
# "ê·¸ë£¨ìˆ˜" ë¬¸ìì—´ì„ í¬í•¨í•˜ëŠ” ì—´ì„ ì œì™¸
data_filtered <- data %>%
  select(-matches("ê·¸ë£¨ìˆ˜"))


# ğŸŸ¥ í•©ê³„ì—´ ì˜®ê¸°ê¸° ===================================================================================================
# "í•©ê³„"ë¥¼ í¬í•¨í•˜ëŠ” ì—´ì„ ì°¾ê³  ê·¸ ì¸ë±ìŠ¤ë¥¼ ì–»ìŠµë‹ˆë‹¤
sum_columns <- grep("í•©ê³„", names(data_filtered))

# ëª¨ë“  ì—´ì˜ ì¸ë±ìŠ¤ë¥¼ ê¸°ë³¸ ìˆœì„œëŒ€ë¡œ ìƒì„±
all_columns <- 1:ncol(data_filtered)

# "í•©ê³„"ë¥¼ í¬í•¨í•˜ëŠ” ì—´ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ì—´
non_sum_columns <- all_columns[!all_columns %in% sum_columns]

# "í•©ê³„" ì—´ì„ 2ë²ˆì§¸ ìœ„ì¹˜ë¡œ ì´ë™
# ì²« ë²ˆì§¸ ì—´ ë‹¤ìŒì— "í•©ê³„" ì—´ì´ ì˜¤ê³ , ë‚˜ë¨¸ì§€ ì—´ì´ ì´ì–´ì§€ë„ë¡ ë°°ì—´í•©ë‹ˆë‹¤.
new_order <- c(non_sum_columns[1], sum_columns, non_sum_columns[-1])

# ìƒˆë¡œìš´ ìˆœì„œë¡œ ë°ì´í„°í”„ë ˆì„ì„ ì¬êµ¬ì„±
data_filtered_reordered <- data_filtered[, new_order]

# ê²°ê³¼ë¥¼ í™•ì¸
data_filtered_reordered %>% View



# ğŸŸ¥ í•©ê³„ ë¹„êµ  ===================================================================================================
names(data_filtered_reordered)
library(dplyr)

# ì¹¨ì—½ìˆ˜ì™€ í™œì—½ìˆ˜ì˜ í•©ê³„ë¥¼ ê³„ì‚°í•˜ê³  ê·¸ ê°’ì„ í•´ë‹¹ í•©ê³„ ì—´ê³¼ ë¹„êµ
data_checked <- data_filtered_reordered %>%
  mutate(ì¹¨ì—½ìˆ˜_ê³„ì‚°ëœ_í•©ê³„ = rowSums(select(., starts_with("ì¹¨ì—½ìˆ˜_"), -ì¹¨ì—½ìˆ˜_í•©ê³„_ë©´ì ), na.rm = TRUE),
         ì¹¨ì—½ìˆ˜_í•©ê³„_ì¼ì¹˜ = ì¹¨ì—½ìˆ˜_ê³„ì‚°ëœ_í•©ê³„ == ì¹¨ì—½ìˆ˜_í•©ê³„_ë©´ì ,
         í™œì—½ìˆ˜_ê³„ì‚°ëœ_í•©ê³„ = rowSums(select(., starts_with("í™œì—½ìˆ˜_"), -í™œì—½ìˆ˜_í•©ê³„_ë©´ì ), na.rm = TRUE),
         í™œì—½ìˆ˜_í•©ê³„_ì¼ì¹˜ = í™œì—½ìˆ˜_ê³„ì‚°ëœ_í•©ê³„ == í™œì—½ìˆ˜_í•©ê³„_ë©´ì ) %>%
  select(êµ¬ë¶„, ì¹¨ì—½ìˆ˜_í•©ê³„_ë©´ì , ì¹¨ì—½ìˆ˜_ê³„ì‚°ëœ_í•©ê³„, ì¹¨ì—½ìˆ˜_í•©ê³„_ì¼ì¹˜,
         í™œì—½ìˆ˜_í•©ê³„_ë©´ì , í™œì—½ìˆ˜_ê³„ì‚°ëœ_í•©ê³„, í™œì—½ìˆ˜_í•©ê³„_ì¼ì¹˜)

# ê²°ê³¼ë¥¼ ì¶œë ¥
print(data_checked)
View(data_checked)


# ğŸŸ¥ ë‚´ë³´ë‚´ê¸°  ===================================================================================================
path_save = "/Users/Ido/Documents/GitHub/KFS_Timeseries_Data/4.Exported Data_by ID/@_á„Œá…©á„…á…µá†·/(@á„‹á…ªá†«á„…á…­)á„‰á…®á„Œá…©á†¼á„‡á…§á†¯ á„Œá…©á„…á…µá†·á„‰á…µá†¯á„Œá…¥á†¨Plantation forest by tree species/@á„‹á…ªá†«á„…á…­"
file_name = paste0("5.2023á„‚á…§á†«á„ƒá…©_á„‡á…©á†¨á„‡á…®á‡€.xlsx")
write.xlsx(data_filtered, file.path(path_save, file_name))



